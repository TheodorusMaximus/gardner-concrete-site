---
import Card from './ui/Card.astro';
import { getProjects } from '../utils/wix-client';

// Fetch projects from Wix CMS (will fall back to static data if no CMS)
let projectData = [];
try {
  projectData = await getProjects('transformations');
} catch (error) {
  console.log('Using static transformation data');
}

// Fallback to static data with placeholder images for now
const transformationProjects = projectData.length > 0 ? projectData : [
  {
    _id: "1",
    title: "Foundation Wall Stabilization",
    location: "Longfellow, Minneapolis",
    category: "Foundation Repair",
    beforeImage: "https://images.unsplash.com/photo-1573161103-e6fc8c2e1dbc?auto=format&fit=crop&w=800&q=80",
    afterImage: "https://images.unsplash.com/photo-1590224505923-372138a3b8bd?auto=format&fit=crop&w=800&q=80",
    description: "Severe foundation wall bowing due to clay soil expansion. Steel I-beam reinforcement with drainage upgrade restored structural integrity permanently.",
    customerQuote: "G. Gardner Concrete & Waterproofing, Inc saved our home. The wall was bowing 3 inches - we thought we'd have to move. Now it's rock solid.",
    customerName: "Sarah & Mike Johnson",
    timeframe: "4 days",
    year: "2024",
    featured: true
  },
  {
    _id: "2", 
    title: "Basement Waterproofing System",
    location: "Highland Park, St. Paul",
    category: "Waterproofing",
    beforeImage: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?auto=format&fit=crop&w=800&q=80",
    afterImage: "https://images.unsplash.com/photo-1581578731548-c64695cc6952?auto=format&fit=crop&w=800&q=80", 
    description: "Chronic basement flooding during spring thaw. Interior drain tile system with battery backup sump pump provided complete waterproofing solution.",
    customerQuote: "Two years later and our basement is still bone dry. Even during that crazy May storm, we stayed completely dry while neighbors flooded.",
    customerName: "Jennifer Chen",
    timeframe: "3 days",
    year: "2024",
    featured: true
  },
  {
    _id: "3",
    title: "Decorative Concrete Patio",
    location: "Edina, MN", 
    category: "Concrete Work",
    beforeImage: "https://images.unsplash.com/photo-1574947318246-0b707d1b8f42?auto=format&fit=crop&w=800&q=80",
    afterImage: "https://images.unsplash.com/photo-1508898578281-774ac4893e2b?auto=format&fit=crop&w=800&q=80",
    description: "Cracked, settling patio unsafe for family gatherings. Complete replacement with stamped concrete and proper drainage created beautiful entertaining space.",
    customerQuote: "The new patio transformed our backyard into the neighborhood gathering spot. It's been two winters and looks perfect.",
    customerName: "Tom & Lisa Rodriguez",
    timeframe: "5 days", 
    year: "2023",
    featured: true
  },
  {
    _id: "4",
    title: "Suspended Garage Floor Installation",
    location: "Plymouth, MN",
    category: "Concrete Work", 
    beforeImage: "https://images.unsplash.com/photo-1567438073125-66726bdcc1cd?auto=format&fit=crop&w=800&q=80",
    afterImage: "https://images.unsplash.com/photo-1586105251261-72a756497a11?auto=format&fit=crop&w=800&q=80",
    description: "Unusable garage space over walkout basement. Engineered suspended slab with proper load calculations created full 2-car garage without losing basement space.",
    customerQuote: "Incredible engineering. We gained a 2-car garage without losing our basement rec room. It's been flawless for over a year.",
    customerName: "Michelle & Greg Anderson", 
    timeframe: "6 days",
    year: "2023",
    featured: true
  }
];
---

<section id="transformations" class="relative py-20 bg-charcoal-black text-concrete-white overflow-hidden">
  <!-- Subtle textured background -->
  <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: url('https://www.transparenttextures.com/patterns/concrete-wall.png'); background-size: 512px;"></div>
  <div class="absolute inset-0 bg-gradient-to-b from-black/20 to-black/40 pointer-events-none"></div>

  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-10 text-center">
      <span class="inline-block bg-construction-orange px-3 py-1 rounded-full text-xs font-semibold text-white shadow">75+ Years of Proven Results</span>
      <h2 class="mt-4 font-montserrat font-extrabold text-3xl sm:text-4xl tracking-tight">
        See the <span class="text-construction-orange">Transformation</span>
      </h2>
      <p class="text-sm sm:text-base text-gray-300 font-lato mt-2 max-w-3xl mx-auto">
        Real projects from Minneapolis homes. Tap any to view details.
      </p>

    </div>

    <!-- Two-column Before/After cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {transformationProjects.slice(0, 2).map((project) => (
        <a href="/our-work" class="group relative block overflow-hidden rounded-2xl glass-panel-dark ring-1 ring-white/10 hover:ring-construction-orange/40 transition">
          <div class="grid grid-cols-2 h-60 sm:h-72 lg:h-80">
            <div class="relative overflow-hidden">
              <img src={project.beforeImage} alt={`Before: ${project.title}`} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" loading="lazy" />
              <div class="absolute top-3 left-3 bg-red-600 text-white px-2 py-0.5 rounded-full text-[10px] font-semibold shadow">BEFORE</div>
            </div>
            <div class="relative overflow-hidden">
              <img src={project.afterImage} alt={`After: ${project.title}`} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" loading="lazy" />
              <div class="absolute top-3 right-3 bg-green-600 text-white px-2 py-0.5 rounded-full text-[10px] font-semibold shadow">AFTER</div>
            </div>
          </div>
          <div class="absolute top-0 bottom-0 left-1/2 w-px bg-white/40 opacity-70 pointer-events-none"></div>
          <div class="absolute left-4 right-4 bottom-4 text-white">
            <div class="font-montserrat text-base sm:text-lg font-semibold drop-shadow">{project.title}</div>
            <div class="text-[11px] text-gray-200/90">{project.category}</div>
          </div>
        </a>
      ))}
    </div>

    <!-- CTA below cards -->
    <div class="text-center mt-10">
      <a href="/our-work" class="inline-block px-6 py-3 rounded-md bg-construction-orange text-white font-semibold shadow-md hover:bg-orange-500 transition-colors">View Our Work â†’</a>
    </div>
  </div>
</section>

<script is:inline>
document.addEventListener('DOMContentLoaded', () => {
  // Smooth scroll to form
  const scrollToFormBtn = document.querySelector('.scroll-to-form');
  if (scrollToFormBtn) {
    scrollToFormBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const formElement = document.getElementById('concrete-booking-form');
      if (formElement) {
        formElement.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
      } else {
        window.location.href = '/#concrete-booking-form';
      }
    });
  }
});
</script>