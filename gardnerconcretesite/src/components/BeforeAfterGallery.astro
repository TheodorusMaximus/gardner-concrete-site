---
import Card from './ui/Card.astro';
import Button from './ui/Button.astro';
import { getProjects } from '../utils/wix-client.js';

// Fetch projects from Wix CMS (will fall back to static data if no CMS)
let projectData = [];
try {
  projectData = await getProjects('transformations');
} catch (error) {
  console.log('Using static transformation data');
}

// Fallback to static data with placeholder images for now
const transformationProjects = projectData.length > 0 ? projectData : [
  {
    _id: "1",
    title: "Foundation Wall Stabilization",
    location: "Longfellow, Minneapolis",
    category: "Foundation Repair",
    beforeImage: "https://images.unsplash.com/photo-1573161103-e6fc8c2e1dbc?auto=format&fit=crop&w=800&q=80",
    afterImage: "https://images.unsplash.com/photo-1590224505923-372138a3b8bd?auto=format&fit=crop&w=800&q=80",
    description: "Severe foundation wall bowing due to clay soil expansion. Steel I-beam reinforcement with drainage upgrade restored structural integrity permanently.",
    customerQuote: "Gardner Concrete saved our home. The wall was bowing 3 inches - we thought we'd have to move. Now it's rock solid.",
    customerName: "Sarah & Mike Johnson",
    timeframe: "4 days",
    year: "2024",
    featured: true
  },
  {
    _id: "2", 
    title: "Basement Waterproofing System",
    location: "Highland Park, St. Paul",
    category: "Waterproofing",
    beforeImage: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?auto=format&fit=crop&w=800&q=80",
    afterImage: "https://images.unsplash.com/photo-1581578731548-c64695cc6952?auto=format&fit=crop&w=800&q=80", 
    description: "Chronic basement flooding during spring thaw. Interior drain tile system with battery backup sump pump provided complete waterproofing solution.",
    customerQuote: "Two years later and our basement is still bone dry. Even during that crazy May storm, we stayed completely dry while neighbors flooded.",
    customerName: "Jennifer Chen",
    timeframe: "3 days",
    year: "2024",
    featured: true
  },
  {
    _id: "3",
    title: "Decorative Concrete Patio",
    location: "Edina, MN", 
    category: "Concrete Work",
    beforeImage: "https://images.unsplash.com/photo-1574947318246-0b707d1b8f42?auto=format&fit=crop&w=800&q=80",
    afterImage: "https://images.unsplash.com/photo-1508898578281-774ac4893e2b?auto=format&fit=crop&w=800&q=80",
    description: "Cracked, settling patio unsafe for family gatherings. Complete replacement with stamped concrete and proper drainage created beautiful entertaining space.",
    customerQuote: "The new patio transformed our backyard into the neighborhood gathering spot. It's been two winters and looks perfect.",
    customerName: "Tom & Lisa Rodriguez",
    timeframe: "5 days", 
    year: "2023",
    featured: true
  },
  {
    _id: "4",
    title: "Suspended Garage Floor Installation",
    location: "Plymouth, MN",
    category: "Concrete Work", 
    beforeImage: "https://images.unsplash.com/photo-1567438073125-66726bdcc1cd?auto=format&fit=crop&w=800&q=80",
    afterImage: "https://images.unsplash.com/photo-1586105251261-72a756497a11?auto=format&fit=crop&w=800&q=80",
    description: "Unusable garage space over walkout basement. Engineered suspended slab with proper load calculations created full 2-car garage without losing basement space.",
    customerQuote: "Incredible engineering. We gained a 2-car garage without losing our basement rec room. It's been flawless for over a year.",
    customerName: "Michelle & Greg Anderson", 
    timeframe: "6 days",
    year: "2023",
    featured: true
  }
];
---

<section id="transformations" class="py-16 sm:py-20 lg:py-24 bg-concrete-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header Section -->
    <div class="text-center mb-12 lg:mb-16">
      <div class="mb-4">
        <span class="inline-block bg-construction-orange px-4 py-2 rounded-full text-sm font-semibold text-white">
          75+ Years of Proven Results
        </span>
      </div>
      <h2 class="font-montserrat font-extrabold text-3xl sm:text-4xl lg:text-5xl text-charcoal-black mb-6">
        See the <span class="text-construction-orange">Transformation</span>
      </h2>
      <p class="max-w-3xl mx-auto text-lg sm:text-xl text-steel-gray font-lato leading-relaxed">
        Real Minneapolis homes, real solutions, real results. Browse through our recent project transformations.
      </p>
    </div>

    <!-- Project Grid -->
    <div class="grid gap-8 lg:gap-12 mb-16">
      {transformationProjects.map((project, index) => (
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
          <div class="grid lg:grid-cols-2 gap-0">
            <!-- Before/After Images -->
            <div class="relative">
              <!-- Simple Before/After Side by Side -->
              <div class="grid grid-cols-2 h-64 sm:h-80 lg:h-96">
                <!-- Before Image -->
                <div class="relative overflow-hidden">
                  <img
                    src={project.beforeImage}
                    alt={`Before: ${project.title}`}
                    class="w-full h-full object-cover"
                    loading="lazy"
                  />
                  <div class="absolute top-3 left-3 bg-red-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                    BEFORE
                  </div>
                </div>
                
                <!-- After Image -->
                <div class="relative overflow-hidden">
                  <img
                    src={project.afterImage}
                    alt={`After: ${project.title}`}
                    class="w-full h-full object-cover"
                    loading="lazy"
                  />
                  <div class="absolute top-3 right-3 bg-green-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                    AFTER
                  </div>
                </div>
              </div>
              
              <!-- Divider Line -->
              <div class="absolute top-0 bottom-0 left-1/2 w-1 bg-white shadow-lg transform -translate-x-1/2 z-10"></div>
            </div>

            <!-- Project Details -->
            <div class="p-6 lg:p-8 flex flex-col justify-center">
              <!-- Project Header -->
              <div class="mb-6">
                <div class="flex items-center gap-3 mb-3">
                  <span class="bg-construction-orange/10 text-construction-orange px-3 py-1 rounded-full text-sm font-semibold">
                    {project.category}
                  </span>
                  <span class="text-steel-gray text-sm">{project.year}</span>
                </div>
                <h3 class="font-montserrat font-bold text-2xl lg:text-3xl text-charcoal-black mb-3">
                  {project.title}
                </h3>
                <p class="text-steel-gray font-medium flex items-center gap-2">
                  <svg class="w-4 h-4 text-construction-orange" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                  </svg>
                  {project.location}
                </p>
              </div>

              <!-- Project Description -->
              <div class="mb-6">
                <p class="text-steel-gray leading-relaxed mb-4">{project.description}</p>
                <div class="flex items-center text-sm text-steel-gray">
                  <span class="font-medium">Completed in:</span>
                  <span class="ml-2 font-semibold text-charcoal-black">{project.timeframe}</span>
                </div>
              </div>

              <!-- Customer Testimonial -->
              <div class="bg-gradient-to-br from-construction-orange/5 to-bright-yellow/5 border border-construction-orange/20 rounded-xl p-6">
                <div class="flex items-center gap-1 mb-3">
                  {[...Array(5)].map(() => (
                    <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                    </svg>
                  ))}
                </div>
                <blockquote class="text-charcoal-black font-medium italic leading-relaxed mb-4">
                  "{project.customerQuote}"
                </blockquote>
                <footer>
                  <cite class="not-italic font-semibold text-charcoal-black">
                    {project.customerName}
                  </cite>
                  <p class="text-steel-gray text-sm">{project.location}</p>
                </footer>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>

    <!-- Stats Section -->
    <div class="bg-charcoal-black text-white rounded-2xl p-8 sm:p-12 mb-16">
      <div class="text-center mb-8 sm:mb-12">
        <h3 class="font-montserrat font-bold text-2xl sm:text-3xl mb-4">
          Transform Your Home with <span class="text-construction-orange">Confidence</span>
        </h3>
        <p class="text-gray-300 text-base sm:text-lg max-w-2xl mx-auto">
          Every project shown represents real Minneapolis families who trusted us with their most important investment.
        </p>
      </div>
      
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 sm:gap-8 text-center">
        <div class="transform transition-transform hover:scale-105">
          <div class="text-3xl sm:text-4xl font-bold text-construction-orange mb-2">2000+</div>
          <div class="text-gray-300 text-sm sm:text-base">Transformations Completed</div>
        </div>
        <div class="transform transition-transform hover:scale-105">
          <div class="text-3xl sm:text-4xl font-bold text-construction-orange mb-2">75+</div>
          <div class="text-gray-300 text-sm sm:text-base">Years of Excellence</div>
        </div>
        <div class="transform transition-transform hover:scale-105">
          <div class="text-3xl sm:text-4xl font-bold text-construction-orange mb-2">4.8★</div>
          <div class="text-gray-300 text-sm sm:text-base">Customer Rating</div>
        </div>
        <div class="transform transition-transform hover:scale-105">
          <div class="text-3xl sm:text-4xl font-bold text-construction-orange mb-2">100%</div>
          <div class="text-gray-300 text-sm sm:text-base">Licensed & Insured</div>
        </div>
      </div>
    </div>

    <!-- Call to Action -->
    <div class="text-center bg-gradient-to-r from-construction-orange to-bright-yellow rounded-2xl p-8 sm:p-12 text-white">
      <h3 class="font-montserrat font-bold text-2xl sm:text-3xl mb-4">
        Ready for Your Transformation?
      </h3>
      <p class="text-lg sm:text-xl mb-6 sm:mb-8 opacity-90 max-w-2xl mx-auto">
        Join thousands of Minneapolis homeowners who've transformed their properties with Gardner Concrete. Your before and after story starts with a free consultation.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <Button href="/#concrete-booking-form" class="bg-white text-construction-orange hover:bg-gray-100 px-8 py-4 text-lg font-semibold scroll-to-form">
          Get Your Free Assessment
        </Button>
        <a href="tel:612-825-8779" class="inline-flex items-center justify-center gap-2 px-8 py-4 text-lg font-semibold rounded-lg border-2 border-white text-white hover:bg-white hover:text-construction-orange transition-colors">
          Call (612) 825-8779
        </a>
      </div>
    </div>
  </div>
</section>

<script is:inline>
document.addEventListener('DOMContentLoaded', () => {
  // Smooth scroll to form
  const scrollToFormBtn = document.querySelector('.scroll-to-form');
  if (scrollToFormBtn) {
    scrollToFormBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const formElement = document.getElementById('concrete-booking-form');
      if (formElement) {
        formElement.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
      } else {
        window.location.href = '/#concrete-booking-form';
      }
    });
  }
});
</script>