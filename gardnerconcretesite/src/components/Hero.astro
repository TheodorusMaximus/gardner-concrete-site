---
import Button from './ui/Button.astro';
import { getFeaturedProjects } from '../utils/wix-api';

// Fetch featured projects for the carousel
const featuredProjects = await getFeaturedProjects();
---

<section class="relative bg-charcoal-black text-concrete-white min-h-[600px] md:min-h-[700px] lg:min-h-[80vh] flex items-center">
  <div class="absolute inset-0">
    <!-- Dark overlay (lightened to reveal background image) -->
    <div class="absolute inset-0 bg-black/0 z-10"></div>
    <!-- Supplied background image -->
    <div class="absolute inset-0 bg-cover bg-center z-5" style="background-image:url('https://pub-023c3e677cc749cd89ec726c78c6178e.r2.dev/darkconcSM.jpg'); opacity:0.25;"></div>
    <!-- Concrete texture overlay -->
    <div class="absolute inset-0 bg-cover bg-center opacity-10 z-5 concrete-texture"></div>
    <!-- Blueprint grid overlay -->
    <div class="absolute inset-0 opacity-10 z-5 blueprint-grid"></div>
    <!-- Mobile background image (hidden on desktop) -->
    <div class="absolute inset-0 hero-slider md:hidden z-5"></div>
  </div>

  <div class="relative w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-24 md:pt-48 md:pb-32 z-20">
    <div class="flex flex-col md:flex-row md:items-center">
      <!-- Left Column (2/3) - Main Content -->
      <div class="md:w-2/3 md:pr-8 text-left md:text-left mb-10 md:mb-0">
        <h1 class="font-montserrat font-extrabold text-4xl sm:text-5xl lg:text-6xl tracking-tighter mb-10">
          Protecting your home's<br/> <strong class="text-primary">safety, value, and beauty.</strong>
        </h1>
        <p class="font-montserrat text-lg md:text-xl mb-16 max-w-2xl text-gray-200 leading-relaxed">
          Dry basements, strong foundations, and beautiful hardscapes built to last and protect your home for generations.
        </p>

        <!-- Call-to-actions -->
        <div class="flex flex-col sm:flex-row items-start gap-4 mb-20">
          <a href="#inspection" class="inline-flex items-center justify-center gap-2 px-6 py-3 text-lg font-semibold rounded-lg bg-primary hover:bg-primary/90 transition-colors shadow-lg">
            üõ†Ô∏è Schedule My Free Inspection
          </a>
          <a href="/our-work" class="inline-flex items-center justify-center gap-2 px-6 py-3 text-lg font-semibold rounded-lg bg-white/10 hover:bg-white/20 border border-white/30 transition-colors">
            üì∑ See Our Work
          </a>
        </div>

        <!-- Trust & Authority Row - Pill Shapes -->
        <div class="flex flex-wrap gap-4">
          <div class="flex items-center px-4 py-2 bg-white/5 border border-primary/30 rounded-full text-gray-200">
            <span class="text-primary/80 mr-2">üèóÔ∏è</span>
            <span class="text-sm"><strong>75+ years</strong> of service</span>
          </div>
          <div class="flex items-center px-4 py-2 bg-white/5 border border-primary/30 rounded-full text-gray-200">
            <span class="text-primary/80 mr-2">üìú</span>
            <span class="text-sm"><strong>Licensed</strong> MN #BC806990</span>
          </div>
          <div class="flex items-center px-4 py-2 bg-white/5 border border-primary/30 rounded-full text-gray-200">
            <span class="text-primary/80 mr-2">‚≠ê</span>
            <span class="text-sm"><strong>4.8 stars</strong> on Google</span>
          </div>
        </div>
      </div>

      <!-- Right Column (1/3) - Construction Graphic -->
      <div class="md:w-1/3 relative">
        <!-- Project Showcase Carousel -->
        <div class="relative h-full min-h-[400px] md:min-h-[550px] lg:min-h-[600px] rounded-lg overflow-hidden border-2 border-primary/30 shadow-lg shadow-primary/20 cursor-pointer transition-transform hover:scale-105" onclick="window.location.href='/our-work'">
          <!-- Carousel Container -->
          <div class="project-carousel absolute inset-0 w-full h-full">
            {featuredProjects.map((project, index) => (
              <div class="carousel-item absolute inset-0 opacity-0 transition-opacity duration-1000 ease-in-out">
                <div class="absolute inset-0 bg-cover bg-center" style={`background-image: url('${project.image}')`}></div>
                <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-black/10 flex flex-col justify-end p-6">
                  <div class="bg-black/50 p-4 rounded-lg backdrop-blur-sm">
                    <div class="flex items-center mb-2">
                      <span class="text-primary text-sm font-bold uppercase tracking-wider">
                        {project.category === 'waterproofing' ? 'Waterproofing' : 
                         project.category === 'foundation' ? 'Foundation Repair' : 
                         project.category === 'hardscapes' ? 'Hardscapes' : project.category}
                      </span>
                      <div class="ml-auto text-yellow-400 text-xs">{'‚≠ê'.repeat(project.rating || 5)}</div>
                    </div>
                    <p class="text-sm text-white italic mb-2">"{project.testimonialText}"</p>
                    <div class="flex items-center">
                      <span class="text-xs text-gray-300">‚Äì {project.customerName}, {project.customerLocation}</span>
                      <span class="ml-auto text-primary/80">{index + 1}/{featuredProjects.length}</span>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
          
          <!-- Navigation Dots -->
          <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2 z-20">
            {featuredProjects.map((project, index) => (
              <button 
                class="w-2 h-2 rounded-full bg-white/50 carousel-dot" 
                data-index={index} 
                aria-label={`View ${project.category} project`}
              ></button>
            ))}
          </div>
        </div>
      </div>
    </div>


  </div>

<style>
  .hero-slider {
    background-size: cover;
    background-position: center;
    animation: hero-slide 24s infinite;
  }

  .concrete-texture {
    background-image: url('https://www.transparenttextures.com/patterns/concrete-wall.png');
    background-repeat: repeat;
  }

  .blueprint-grid {
    background-image: linear-gradient(to right, rgba(100, 149, 237, 0.15) 1px, transparent 1px),
                      linear-gradient(to bottom, rgba(100, 149, 237, 0.15) 1px, transparent 1px);
    background-size: 30px 30px;
  }

  .carousel-item:nth-child(1) {
    opacity: 1;
  }

  .carousel-dot:nth-child(1) {
    background-color: white;
  }

  @keyframes hero-slide {
    0% {
      background-image: url('https://images.unsplash.com/photo-1569429594168-a4a3a693b8b9?auto=format&fit=crop&w=1920&q=80');
    }
    33% {
      background-image: url('https://images.unsplash.com/photo-1585426772931-0677e6ba8ced?auto=format&fit=crop&w=1920&q=80');
    }
    66% {
      background-image: url('https://images.unsplash.com/photo-1600566753215-f5825ae6525d?auto=format&fit=crop&w=1920&q=80');
    }
    100% {
      background-image: url('https://images.unsplash.com/photo-1569429594168-a4a3a693b8b9?auto=format&fit=crop&w=1920&q=80');
    }
  }

  @media (max-width: 768px) {
    .project-carousel {
      display: none;
    }
  }
</style>

<script>
  // Simple carousel functionality
  document.addEventListener('DOMContentLoaded', () => {
    const items = document.querySelectorAll('.carousel-item');
    const dots = document.querySelectorAll('.carousel-dot');
    let currentIndex = 0;
    
    // Auto-rotate every 7 seconds
    setInterval(() => {
      currentIndex = (currentIndex + 1) % items.length;
      updateCarousel();
    }, 7000);
    
    // Click handlers for dots
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        currentIndex = index;
        updateCarousel();
      });
    });
    
    function updateCarousel() {
      // Update items visibility
      items.forEach((item, index) => {
        item.style.opacity = index === currentIndex ? '1' : '0';
      });
      
      // Update dots
      dots.forEach((dot, index) => {
        dot.style.backgroundColor = index === currentIndex ? 'white' : 'rgba(255, 255, 255, 0.5)';
      });
    }
  });
</script> 